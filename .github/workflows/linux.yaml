name: Linux

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: [ ubuntu-latest ]
    permissions:
      contents: write
    steps:
      - name: Get the latest version
        run: |
          VERSION=$(curl -s https://api.github.com/repos/ninja-build/ninja/releases/latest | grep -Po '"tag_name": "\Kv[0-9.]+')
          CURRENT_VERSION=$(curl -s https://api.github.com/repos/${{ github.repository }}/releases/latest | grep -Po '"tag_name": "\Kv[0-9.]+' || true)
          if [ "$VERSION" = "$CURRENT_VERSION" ]; then
            echo "Up to date $VERSION."
            exit 0
          fi
          echo "VERSION=$VERSION" >> $GITHUB_ENV
      - name: Clone the repository
        uses: actions/checkout@v5
      - name: Build the project
        run: echo ${{ github.sha }} > Release.txt
      - name: Publish the release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.VERSION }}
          body: "[Release notes](https://github.com/ninja-build/ninja/releases/tag/${{ env.VERSION }})"
          files: Release.txt


#      - name: Build the Docker image
#        run: docker build -t ninja scripts
#      - name: Build the project
#        run: docker run --rm -v ./:/app ninja scripts/compile.sh
#      - name: Publish the release
#        uses: softprops/action-gh-release@v2
#        with:
#          files: 1.0.0
